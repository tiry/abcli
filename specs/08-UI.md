# Agent Builder UI Specification

## Overview

This specification outlines the development of a web-based UI for the Agent Builder CLI, which will provide a graphical interface for managing and interacting with agents. The UI will be built using Streamlit and will be accessible through the main CLI tool via an `ab ui` command.

## Architecture

### Integration Approach

The UI will follow a hybrid architecture:

1. **Command Integration**: The main `ab-cli` package will include an `ab ui` command that launches the Streamlit-based UI
2. **Separate Implementation**: The actual UI implementation will reside in a dedicated package (`abui`) that will:
   - Use the existing `ab-cli` package as a dependency
   - Interact with the Agent Builder API through the CLI's functionality

```
┌───────────────┐                 ┌────────────────┐               ┌───────────────────┐
│               │  launches       │                │  uses as      │                   │
│  ab ui command├────────────────►│  abui package  ├──────────────►│ ab-cli functions  │
│               │                 │  (Streamlit)   │  dependency   │                   │
└───────────────┘                 └────────────────┘               └───────────────────┘
                                         │                                  │
                                         │                                  │
                                         ▼                                  ▼
                                  ┌────────────────┐               ┌───────────────────┐
                                  │                │               │                   │
                                  │   Web Browser  │               │   Agent Builder   │
                                  │    Interface   │               │       API         │
                                  │                │               │                   │
                                  └────────────────┘               └───────────────────┘
```

### Package Structure

The UI implementation has evolved to use a slightly different structure than initially planned:

```
ab-cli/
├── ab_cli/
│   ├── cli/
│   │   ├── ui.py (contains the 'ab ui' command)
│   │   └── ...
│   ├── abui/
│   │   ├── __init__.py
│   │   ├── app.py (main Streamlit application)
│   │   ├── views/
│   │   │   ├── agents.py (agent listing)
│   │   │   ├── agent_details.py (detailed agent view)
│   │   │   ├── edit_agent.py (agent editing)
│   │   │   └── chat.py (chat interface)
│   │   ├── components/
│   │   │   ├── agent_card.py (reusable agent display component)
│   │   │   └── ...
│   │   └── utils/
│   │       ├── config.py (configuration handling)
│   │       └── ...
│   └── ...
└── ...
```

## Core Features

### 1. Agent Listing & Management

#### Agent Listing
- Display a grid or list of available agents
- Show key information: name, ID, type, status, creation date
- Provide filtering and sorting options
- Include pagination for large numbers of agents

#### Agent Details
- Show detailed information about a selected agent in a tabbed interface:
  - General Info: Basic agent information
  - Configuration: Detailed agent configuration with structured display
  - Versions: Version history with the ability to select a specific version
  - Statistics: Usage metrics (placeholder for future expansion)
- Action buttons prominently displayed at the top of the page for Edit and Chat
- Clean layout focusing on the most important information

#### Agent Creation & Editing
- Form-based interface for creating new agents
- Input validation for required fields
- Support for editing existing agents
- Option to create a new version of an existing agent

### 2. Chat Interface

#### Chat with Agents
- Provide a chat-like interface for interacting with agents
- Support for selecting different agent versions
- Display message history with clear distinction between user and agent messages
- Allow exporting of conversation transcripts

#### Chat History
- Save and display chat history
- Option to clear history and start new conversations

### 3. Navigation

- Clean, button-based navigation in the sidebar
- Visual indication of the current page (primary/secondary button styling)
- State-based navigation between different views
- Robust handling of navigation intent to ensure consistent page transitions

## Technical Implementation

### Navigation System

The UI uses a combination of Streamlit's standard navigation and a custom state-based approach:

1. **Main Navigation**: Top-level navigation uses dedicated buttons in the sidebar
2. **Page State Management**: Current page is tracked in `st.session_state.current_page`
3. **Navigation Intent**: A `nav_intent` system enables complex transitions between views

### Configuration Handling

- The UI uses the same configuration mechanism as the CLI via `load_config()`
- Configuration is passed directly to the Agent Builder Client without additional wrapping
- Configuration state is maintained in Streamlit session state for use across different views

### Agent Interaction

- Agent data is loaded and stored in session state for consistent access
- Detailed agent information is fetched when needed, with proper loading indicators
- Configuration is automatically fetched when needed for operations like editing

### Error Handling

- Robust error handling with appropriate fallbacks
- Comprehensive error messages when operations fail
- Fallback mechanisms for common failure modes (like JSON parsing errors)

## Testing and Quality Assurance

### Code Quality Checks

The codebase follows strict quality guidelines with automated checks:

- **Formatting**: All files are formatted with ruff format
- **Linting**: Code is checked with ruff for common issues
- **Type Checking**: Strict type checking with mypy
- **CI Integration**: Quality checks are integrated into the CI workflow

### Testing

- Manual testing of all UI flows
- Unit tests for critical functionality
- Integration tests for API interaction

## Future Enhancements

These features are not part of the initial implementation but may be considered for future releases:

- Advanced agent analytics and performance metrics
- Batch operations on multiple agents
- Export/import functionality for agents
- User management and role-based access
- Custom themes and appearance settings
- Integration with version control systems

## Implementation Notes

### Key UI Improvements

1. **Navigation Enhancement**:
   - Replaced radio buttons with proper action buttons
   - Improved state management for more reliable navigation
   - Added visual indication of the current page
   - Fixed duplicate navigation links in the left panel

2. **Agent Details Layout**:
   - Action buttons moved to the top for better visibility
   - Tabbed interface for better organization of information
   - Cleaner information display focusing on essential details

3. **Table View Improvements**:
   - Fixed alternating row colors with proper CSS styling
   - Improved table row structure using container elements
   - Enhanced action buttons styling and layout in table view
   - Added proper padding and margins for better readability

4. **Chat Interface Robustness**:
   - Enhanced model field detection with multiple fallback strategies
   - Improved JSON extraction from command outputs
   - Better error handling for edge cases

5. **General Improvements**:
   - Fixed configuration loading issues
   - Added comprehensive type hints for better code quality
   - Improved error handling and feedback throughout the UI
   - Fixed linting issues with proper whitespace handling

### CSS Enhancements

The UI appearance has been improved with better CSS styling:

```css
/* Style for alternating row colors */
.even-bg { background-color: #f8f9fa; }
.odd-bg { background-color: #ffffff; }

/* Make buttons look better inside the table */
.stButton > button {
    padding: 2px 8px !important;
}
```

### Table Row Implementation

Table rows now use a container approach for better styling and consistent appearance:

```python
# Use a container to group the row elements with alternating background color
with st.container():
    # Inject the background color with proper alternation
    bg_color = "#f8f9fa" if i % 2 == 0 else "#ffffff"
    st.markdown(
        f'<div style="background-color: {bg_color}; padding: 10px; border-radius: 4px; border: 1px solid #eee; margin-bottom: 4px;">',
        unsafe_allow_html=True,
    )

    # Content columns go here...

    # Close the wrapping div after content
    st.markdown("</div>", unsafe_allow_html=True)
```

## Documentation

Additional documentation about the UI is available in the `UI.md` file, which includes:
- Screenshots and visual guides
- Usage instructions
- Key feature descriptions
- Tips and troubleshooting advice